---
title: "Land Map"
date: "`r Sys.Date()`"
output: html_document
---

```{r knitr_init, echo=FALSE, cache=FALSE}
## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE,
               widgetframe_widgetsdir = 'widgets')
opts_knit$set(width=75)
```

# Load Environment and Helper Functions

```{r}
library(sf)
library(raster)
library(dplyr)
library(ggplot2)
library(showtext)

# Add custom fonts
font_add_google("Hanalei", "Hanalei")
font_add_google("Hanalei Fill", "Hanalei Fill")
# automatically use showtext to render text
showtext_auto()
# source theme
source(here::here("R/themes/", "road_theme.R"))
# source ggplot2 code for basemaps
source(here::here("R/ggplot2", "vanilla_base.R"))
source(here::here("R/ggplot2", "depth_base.R"))
source(here::here("R/ggplot2", "moisture_base.R"))
source(here::here("R/ggplot2", "solrad_base.R"))



source(here::here("R/ggplot2", "make_maps.R"))
```

# Make base maps for all of the islands

You should probably take out the `else/if` from the `make_maps()` and just load the `.rds` add another layer and re-save below...

```{r}
make_maps("hawaii")
make_maps("maui")
make_maps("oahu")
make_maps("kauai")
```

Exploring new shapefiles

```{r}
agriculture_geo <- sf::read_sf(here::here("data/shapefiles/corrected_projections", "alish.shp"))

agriculture_geo <- sf::read_sf(here::here("data/shapefiles/biological/carbon", "cah_land_cover_poly.shp"))
agriculture_geo$Maj_LC <- as.factor(agriculture_geo$Maj_LC)
levels(agriculture_geo$Maj_LC) <- agriculture_vec

ggplot() +
        geom_sf(
      data = agriculture_geo,
      fill = Maj_LC,
      color = "transparent",
      alpha = 0.2
    )
```


# Trying out Magick Shadow effects

It appears this method disables x11() and it remains unseen as to whether or not when rending this into a pdf if it will maintain the custom font brought in by `showtext`. Well this doesn't seem to save a figure, it opens it in the Viewer panel - looks great!!

Now how do you export this to pdf?

```{r}
library(magick)
img <- image_graph()
state_base
dev.off()
image_shadow(img, geometry = "100x20+30+30")

```

# High quality for sure but you need to figure this out!

Says the guy who writes ggplot Thomas Pederson!!!

He was recommending A4 paper and a resolution of `1500 x 1500`.
A4 is 210 x 297 millimeters.

```{r}
file <- here::here("figures/test.png")
agg_png(file, background = "transparent", res = 1500, bitsize = 16, width = 210, height = 297, units = "mm")
moisture_basemap # this is the plot
dev.off() # turn off graphics device

```

It looks absolutely phenomenal! Print worthy for sure; however, I will need to adjust the size of legened text and objects and the title because they are SOOOOOO tiny!